<!-- SIN task -->

<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width">

        <title>Big Speech Experiment</title>

        <link href="lib/jsPsych-master/css/jspsych.css" rel="stylesheet" type="text/css"></link>
    
        <style>
            .instruc {
                width: 50vw;
            } /* formatting for instructions text */
            
            .trialtext {
                width: 50vw;
                position: fixed;
                text-align: left;
                left: 15vw;
                top: 25vh;
                font-size:20px;
            } /* formatting for trial/feedback text */
            
            .nextbutton {
                position: fixed;
                bottom: 0;
                left: 0;
                width: 150px;
            }
            .nextbutton:hover {
                border: 1px solid #777;
            } /* formatting of the next button */
            
            body {
                background-color: #B0C4DE;
            }
            /* background color of the window */
            
            /* Button grid for SIN task */
            .button {
                background-color: #4CAF50; /* Green by default */
                border: none;
                color: white;
                padding: 30px 0px;
                width: 10vw;
                text-align: center;
                text-decoration: none;
                font-size: 20px;                
                border-radius: 3px;
                background-image: linear-gradient(to bottom,transparent,transparent 50%,rgba(0,0,0,.04));
                box-shadow: inset 0 0 0 1px rgba(255,255,255,.05), inset 0 1px 0 0 rgba(255,255,255,.45), inset 0 -1px 0 0 rgba(255,255,255,.15), 0 1px 0 0 rgba(255,255,255,.15);
            }
            .button_blue {background-color: #008CBA;} /* Blue */
            .button_red {background-color: #f44336;} /* Red */ 
            .button_white {background-color: #ffffff; color: black;} /* White */   
            
            .image {
                height: 32vh; /* Each contour image will be slightly < 1/3 of the screen height */
            }
            .image:hover {
                border: 1px solid #777;
            }
            /* Images will have a black border when hover over them */
            
            .feedbackcorrect{
                height: 32vh;
                border: 3px solid #00FF00;
            }
            /* green border for correct answer */
            
            .feedbackwrong{
                height: 32vh;
                border: 3px solid #FF0000;
            }
            /* red border for incorrect */
            
            .repeatbutton {
                position: fixed;
                bottom: 0;
                left: 0;
                width: 150px;
            }
            .repeatbutton:hover {
                border: 1px solid #777;
            } /* formatting of the repeat button */
            
            .imgbutton {
                width: 30vw;
                max-width: 30vh;
                height: auto;
            } /* emoji buttons in tone-scramble task */

        </style>
    </head>

    <body>
    <p>Preparing the experiment... This should only take a few seconds.</p>
    
    <!-- data mgmt, math helper, and sound generation functions -->
    <script src="lib/data_mgmt.js" type="text/javascript"></script>
    <script src="lib/math_helpers.js" type="text/javascript"></script>
    <script src="lib/sound_functions_pd_all.js" type="text/javascript"></script>
        
    <!-- PapaParse functions -->
    <script src="lib/PapaParse/papaparse.js"></script>

    <!-- JsPsych functions -->
    <script src="lib/jsPsych-master/jspsych.js"></script>
    <script src="lib/jsPsych-master/plugins/jspsych-html-keyboard-response.js"></script>
    <script src="lib/jsPsych-master/plugins/jspsych-audio-keyboard-response.js"></script>
    <script src="lib/jsPsych-master/plugins/jspsych-audio-button-response.js"></script>
    <script src="lib/jsPsych-master/plugins/jspsych-html-button-response.js"></script>
    <script src="lib/jsPsych-master/plugins/jspsych-html-button-response_grid.js"></script>
    <script src="run_sin_exp.js"></script>
    <script src="run_tonescramble_exp.js"></script>
    <script src="run_shape_exp.js"></script>

    <script>
        var timeline_full = [];
        var trialData = [];                 // user data that gets saved to a csv at the end
        var taskCounter = 0;
        
        var sin_stuff = run_sin_exp(timeline_full,taskCounter++);
        
        var tonescramble_stuff = run_tonescramble_exp(timeline_full,taskCounter++);
        
        var shape_stuff = run_shape_exp(timeline_full,taskCounter++);
        
        var final_end_screen = {
            type: 'html-button-response',
            stimulus: '',
            choices: ['next'],
            on_start: function(end_screen) {
                
                end_screen.stimulus = ('<p>You have finished all tasks. Thank you for participating! You will receive your credit within a week.</p>');
                
                //Save data locally as csv. Source: https://github.com/mholt/PapaParse/issues/175
                var blob = new Blob([ConvertToCSV(trialData)]);
                if (window.navigator.msSaveOrOpenBlob)  // IE hack; see http://msdn.microsoft.com/en-us/library/ie/hh779016.aspx
                    window.navigator.msSaveBlob(blob, "data_ALL.csv");
                else
                {
                    var a = window.document.createElement("a");
                    a.href = window.URL.createObjectURL(blob, {type: "text/plain"});
                    a.download = "data_ALL.csv";
                    document.body.appendChild(a);
                    a.click();  // IE: "Access is denied"; see: https://connect.microsoft.com/IE/feedback/details/797361/ie-10-treats-blob-url-as-cross-origin-and-denies-access
                    document.body.removeChild(a);
                }
                }
        }
        
        timeline_full.push(final_end_screen);
        
        
        jsPsych.init({
            preload_audio: [sin_stuff[1],shape_stuff[1]], // preload audio for faster execution
            preload_images: [tonescramble_stuff[1],shape_stuff[2]],
            timeline: timeline_full
        });
  
    </script>
    </body>
</html>
